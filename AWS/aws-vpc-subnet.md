# AWS VPC 에 대해서 알아보자 (아마존 웹 서비스 네트워크의 기초)

tags: aws, vpc, subnet, 서브넷

## 참고 URL
- vpc에 대해서 구체적으로 설명하고 있다. https://www.44bits.io/ko/post/understanding_aws_vpc#%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0-%EC%95%84%EB%A7%88%EC%A1%B4-vpc%EB%A5%BC-%EA%BC%AD-%EC%9D%B4%ED%95%B4%ED%95%B4%EC%95%BC%ED%95%98%EB%82%98%EC%9A%94

## 목차
1. [들어가며: 아마존 VPC를 꼭 이해해야 하나요?](#들어가며-아마존-vpc를-꼭-이해해야-하나요)
1. 아마존 버추얼 프라이빗 크라우드(Amazon VPC)의 이해
1. 아마존 VPC는 언제 사용할까요?
1. 기본 VPC의 구성 요소들
    1. VPC
    1. 서브넷(Subnet)
    1. 라우트 테이블(Route Table)
    1. 인터넷 게이트웨이(Internet Gateway)
    1. DHCP 옵션셋(DHCP options set)
    1. 네트워크 ACL(Network ACL) / 시큐리티 그룹(Security Group)
1. 첫 번째 스텝: VPC 생성하기
1. 두 번째 스텝: 서브넷 만들기
1. 세 번째 스텝: 인터넷 기이트웨이 만들기
1. 마치며

## 들어가며: 아마존 VPC를 꼭 이해해야 하나요?
아마존 웹서비스를 사용하다 보면 VPC나 서브넷과 같은 개념을 자주 접하게 됩니다. 하물며 AWS의 가장 기본이 되는 서비스인
EC2 인스턴스를 만들 때도 VPC와 서브넷을 지정해야합니다. 이러한 개념을 정확히 모르더라도 AWS를 사용하는게 불가능한 것은
아닙니다. 그렇다면 VPC를 꼭 이해해야할까요? AWS를 충분히 활용하기 위해서는 그렇습니다.

아마존 웹 서비스는 서버 호스팅 서비스가 아닌 클라우드 서비스로 분류됩니다. 클라우드서비스에는 기존 서버 호스팅과
차별화된 중요한 특징들이 있습니다. 중요한 차이중 하나가 바로 네트워크 환경을 직접 설계할 수 있다는 점입니다.
처음부터 이러한 차이가 부각 되었던 것은 아닙니다. 독립된 네트워크 환경을 구성할 수 있는
버추얼 프라이빗 클라우드(VPC, Virtual Private Cloud)는 2011년 8월에 처음 릴리스 되었습니다. 현재는 AWS에서 
제공되는 대부분의 서비스가 VPC에 의존적입니다. VPC를 의식하지 않고도 AWS를 사용할 수 있습니다만, 그 뒤에는
아마존 웹서비스에서 계정 생성 시 함께 생성되는 기본 VPC(Default VPC)가 있습니다.

따라서 AWS의 서비스들을 제대로 이해하고 사용하기 위해서는 VPC에 대한 기본적인 이해는 필수적입니다. 이 글에서는 
기본 VPC의 구성 요소들을 살펴보고 직접 만들어가면서 VPC를 배워보겠습니다.


## 아마존 버추얼 프라이빗 클라우드(Amazon VPC)의 이해

VPC를 만들어 보기에 앞서 VPC가 무엇인지 이해해야 합니다. 아마존 VPC의 공식 웹페이지에서는 VPC를 다음과 같이 소개합니다.

> Amazon Virtual Private Cloud(VPC)를 사용하면 AWS 클라우드에서 논리적으로 격리된 공간을 프로비저닝하여 고객이 정의하는
가상 네트워크에서 AWS 리소스를 시작할 수 있습니다. IP 주소 범위 선택, 서브넷 생성, 라우팅 테이블 및 네트워크 게이트웨이
구성 등 가상 네트워킹 환경을 완벽하게 제어할 수 있습니다. VPC에서 IPv4와 IPv6를 모두 사용하여 리소스와 애플리케이션에 
안전하고 쉽게 액세스할 수 있스빈다. [- 아마존 버추얼 프라이빗 클라우드(Amazon Virtual Private Cloud)](https://aws.amazon.com/ko/vpc/) 

이 소개에서 `논리적으로 격리된 공간을 프로비저닝한다`는 내용에 주목해 주세요. 아마존 웹 서비스는 기본적으로 다양한 고객들이 사용하는
공용 환경입니다. 사용자들은 이 환경 위에서 EC2 인스턴스와 RDS 데이터베이스를 비롯한 다양한 리소스들을 생성해서 사용합니다.
클라우드 위에서 생성한 리소스들은 기본적으로 네트워크를 통해서 접근합니다. 이 때 하나의 계정에서 생성하는 리소스들만의 격리된
네트워크를 만들어주는 기능이 바로 VPC입니다. VPC를 사용하면 특정 사용자의 리소스들이 논리적으로 격리된 네트워크에서 생성되기
때문에 다른 사람들은 접근하는 것은 물론 보는 것도 불가능합니다.

2019년 현재 VPC는 모든 사용자에게 강제적으로 적용되어 있습니다. 따라서 VPC 없이는 대부분의 서비스를 사용하는 것이 불가능합니다.
앞서 이야기했습니다만 아마존 VPC가 처음부터 강제적으로 적용되어 있던 것은 아닙니다. 아마존 VPC가 정식 서비스로 릴리스 된 것은 
2011년 8월입니다. 이 이전에는 EC2-클래식(EC2 Classic) 네트워크 환경이 사용되었습니다.

> EC2-Classic 사용을 통해 다른 고객과 공유하는 단일 일반 네트워크에서 인스턴스가 실행됩니다. Amazon VPC 사용을 통해 AWS 계정에
속하도록 논리적으로 독립된 Virtual Private Cloud(VPC)에서 인스턴스가 실행됩니다.
Amazon EC2의 최초 출시 당시 EC2-Classic 플랫폼이 도입되었습니다. 2013년 12월 4일 이후에 AWS 계정을 생성한 경우 
EC2-Classic을 지원하지 않으니 VPC에서 Amazon EC2 인스턴스를 시작해야 합니다. 
계정이 EC2-Classic을 지원하지 않는 경우 기본 VPC가 생성됩니다. 기본적으로 인스턴스를 시작할 때 이를 기본 VPC에 시작합니다. 
또는 기본 VPC가 아닌 VPC를 생성하고 인스턴스를 시작할 때 이를 지정할 수 있습니다. [– Amazon EC2 네트워크 및 보안 EC2-Classic](https://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/ec2-classic-platform.html)

위의 내용에서 알 수 있듯이 EC2-클래식 네트워크 환경은 다른 사용자들과 함께 사용하는 공용 공간입니다. 
과거에는 EC2-클래식과 EC2-VPC 네트워크 환경을 선택해서 사용할 수 있었습니다. 
물론 아마존 VPC 출시 이전에는 EC2-클래식 네트워크 환경만 제공되었습니다.

아마존 VPC가 릴리스 되고 2년이 지난 2013년 12월 4일 이후 생성된 AWS 계정에서는 EC2-Classic 네트워크 환경을 더 이상 
사용할 수 없습니다. 따라서 더 이상 아마존 VPC는 선택사항이 아닙니다. 하지만 EC2 인스턴스 하나를 만들기 위해서 사용자가 
직접 네트워크 환경을 직접 구축해야한다면 불편하고 복잡할 것입니다. 사용자가 직접 네트워크 환경을 설계할 수 있다는 것은
아주 큰 장점이지만, 바로 사용할 수 있는 기본 환경을 제공하는 것도 중요합니다. 따라서 AWS에서는 AWS 계정을 생성할 때 
리전 별로 기본 VPC를 함께 생성해줍니다. 이 기본 VPC를 사용하면 아마존 VPC를 크게 의식하지 않더라도 EC2-클래식
네트워크를 사용하듯이 쉽게 AWS에서 제공하는 서비스들을 이용할 수 있습니다.
또한 기본 VPC를 사용하더라도 EC2-클래식과 달리 격리된 네트워크 환경의 장점을 누릴 수 있습니다.

![ec2-classic과 VPC 네트워크의 차이](./images/aws-ec2-classic-vpc-diff.png)


하지만 AWS 위에서 프로덕션 환경을 구축하기 위해서는 아마존 VPC에 대한 좀 더 깊은 이해를 필요로 합니다
직접 VPC를 디자인하고 구축하진 않더라도 최소한 기본 VPC가 어떻게 구성되어 있는지만 이해하고 있더라도 큰 도움이 
될 것입니다. 이 글의 최종 목표는 기본 VPC 구성 요소들을 살펴보고, 마법사를 사용하지 않고 기본 VPC를 직접 만들어보는
일입니다.  








