# 04 _데이터 검색

문서는 색인시 설정한 분석기에 의해 **분석 과정을 거쳐 토큰으로 분리**되는데, 이러한 **분석기는 색인 시점에 사용할수도 있지만 검색 시점에 사용하는 것도 가능하다.**    
특정 문장이 검색어로 요청되면 분석기를 통해 분석된 토큰의 일치 여부를 판단해서 그 결과에 **점수(Score)** 를 매긴다.   
\- p148

엘라스틱 서치는 관계형 데이터베이스와 다르게 페이징된 해당 문서만 선택적으로 가져오는 것이 아니라 모든 데이터를 읽게 된다. 예를 들어, 예제와 같이 5건씩 페이징한 검색 결과의 2페이지를 요청하더라도 총 10건의 문서를 읽어야만 한다.  
\- p163

## 4.2. Query DSL 이해하기

### 4.2.2. Query DSL 쿼리와 필터

#### 필터 컨텍스트
- `Yes/No` 로 판단 할 수 있는 수준의 조건 검색시 필터 컨텍스트를 이용.
- 연관성 관련 계산을 하지 않음.
- 엘라스틱서처 레벨에서 처리, 상대적으로 빠름
- 예시) "create_year" 필드 값이 2018년인지 여부, "status" 필드에 "use" 라는 코드 포함 여부

필터 컨텍스트 Query DSL 예시: 
```json
POST movie_search/_search
{
    "query": {
        "bool": {
            "must":[
                {
                    "match_all": {}
                }
            ],
            "filter": {
                "term": {
                    "repGenreNm": "다큐멘터리"
                }
            }
        }
    }
}
```

#### 쿼리 컨텍스트
- 전문 검색 시 사용
- 분석기에 의한 분석 수행, 연관성 관련 score 계산, 루씬 레벨에서 분석 과정을 거침, 상대적으로 느림
- 예시) "Harry Potter" 같은 문장 분석

쿼리 컨텍스트 Query DSL 예시:
```json
POST movie_search/_search
{
    "query": {
        "match": {
            "movieNm": "기묘한 가족"
        }
    }
}
```

### 4.2.3. Query DSL의 주요 파라미터